






OK... VAMOS COMECAR COM A PRIMEIRA CONSIDERACAO 

IMPORTANTE,


A RESPEITO DAS "VIRTUAL WAREHOUSES">..








OK, AS MELHORES PRACTICES ACERCA DE WH SAO:









1) SEMPRE DEIXE AUTO-SUSPEND HABILITADO....



--> ISSO QUER DIZER QUE __ APÓS CERTO PERÍODO, QUE 
PODEMOS ESPECIFICAR,
A NOSSA WAREHOUSE SERÁ SUSPENSA AUTOMATICAMETNE (
    e isso reduz nossos custos...
)




PODEMOS FAZER ISSO COM COMANDOS SQL,

BASTA ESCREVER ASSIM:






CREATE WAREHOUSE BP_WH 
WITH WAREHOUSE_SIZE = 'XLARGE'
WAREHOUSE_TYPE='STANDARD'
AUTO_SUSPEND=600
AUTO_RESUME=TRUE
MIN_CLUSTER_COUNT=1
MAX_CLUSTER_COUNT=2
SCALING_POLICY='STANDARD';



DROP WAREHOUSE BP_WH;







TAMBÉM PODEMOS CRIAR NOSSAS WAREHOUSES NA GUI...






-------------------------------









--> O PROFESSOR LOGO FALARÁ, TAMBÉM,



SOBRE QUANTO SERIA UMA QUANTIDADE 


BOA PARA O "AUTO-SUSPEND TIME"...


















2) SE USARMOS A FEATURE DE "AUTO-SUSPEND",


DEVEMOS HABILITAR TAMBÉM __ 


A FEATURE __ DE 

"AUTO-RESUME"...






--> PQ CASO CONTRÁRIO, SE NOSSA WAREHOUSE 
FOR SUSPENSA AUTOMATICAMENTE E ALGUNS USERS 

QUISEREM QUERIAR USANDO ESSA VIRTUAL WAREHOUSE,

ELES NAO CONSEGUIRAO FAZER ISSO, SE ESSE 

AUTO-RESUME NAO ESTIVER ENABLED...






--> POR ISSO SEMPRE DEIXE O AUTO-RESUME ENABLED...

















3) SEMPRE DEIXE TIMEOUTS __ APROPRIADOS...







--> VC DEVE DEIXAR TIMEOUTS APROPRIADOS 

A DEPENDER 
DO __ PROPÓSITO_ DE SUA 

WAREHOUSE...







O ESQUEMA É ESTE:






TIMEOUTS DEPENDENDO DAS COISAS:


ETL/DATA LOADING --> IMEDIATAMENTE.

BI/SELECT QUERIES --> 10 MINUTOS

DEVOPS/DATA SCIENCE --> 5 minutos.












AQUI TEMOS 1 DETALHE....







--> NA GRAPHICAL INTERFACE,



A OPCAO DE "IMMEDIATELY" (ou seja, NUNCA 
DEIXAR O NEGÓCIO FICAR SUSPENDED...
)

NAO EXISTE....







--> OU SEJA, SE QUEREMOS DEFINIR 

ESSA OPTION (perfeita para ETL/DATA-LOADING),




devemos definir:





1) NA GRAPHICAL INTERFACE,


DEVEMOS ESCOLHER "nEVER"



OU, ENTAO,






2) NOS COMANDOS SQL, DEFINIR 

A FLAG DE "AUTO_SUSPEND" COMO 0...



ex:


"AUTO_SUSPEND=0"...















--> SE VC QUISER QUE 


SUA WAREHOUSE FIQUE SUSPENSA 

RAPIDAMENTE, por outro lado,



VC 

DEVE


DEIXAR 


O AUTO_SUSPEND COMO 


'1'  (quer dizer que 


SUA WAREHOUSE VAI SER SUSPENSA 

SE ELA FICAR IDLE POR 

1 segundo...
)















-> SE ESTAMOS USANDO UMA VIRTUAL WAREHOUSE 



PARA PROPÓSITOS 


DE __ BI QUERIES/QUERIES QUE 


ENVOLVEM 1 MONTE DE 
SELECT STATEMENTS,



FAZ SENTIDO 


DEIXAR 




O SUSPEND TIME MAIS __ LARGO____( como 10 minutos),


PQ, COM ISSO, PODEMOS NOS APROVEITAR 



DO 

"WARM CACHE",


TUDO PARA QUE QUERIES CONSIGAM SER EXECUTADAS 

MAIS RAPIDAMENTE,

O QUE VAI LEVAR A UMA MELHOR USER EXPERIENCE....













--> JÁ SE ESTAMOS USANDO UMA VIRTUAL WAREHOUSE 




__ PARA PROPÓSITOS DE DEVELOPMENT 
OU DATA SCIENCE,


TEMOS MAIS UNIQUE QUERIES... --> NESSES CASOS,


O "WARM CACHE" NAO É TAO IMPORTANTE,


PQ NAO TEREMOS TANTAS QUERIES 

REPETITIVAS... (similares)...















--> POR ISSO DEVOPS E DATA SCIENCE 


É BOM 


DEIXAR O AUTO-SUSPEND TIME COMO 


SENDO 5 MINUTOS (um valor um pouco menor)...





---------------------------




OK... MAS OUTRO ASPECTO IMPORTANTE É:











4) ESCOLHER O _ TAMANHO __ APROPRIADO _ 
DE NOSSAS WAREHOUSES....





--> PQ SE TIVERMOS QUERIES MT COMPLEXAS,

QUE DEMORAM MT TEMPO,


NAO HÁ NENHUM PROBLEMA 


DEIXAR O WAREHOUSE SIZE MAIOR...







-> MAIS TARDE, SE PERCEBERMOS QUE 


O TAMANHO É SUFICIENTE,

PODEMOS 


REDUZIR O TAMANHO 


DE NOSSA WAREHOUSE...







-> NÓS NAO DEVEMOS NOS FOCAR MT 


NO USO DE "SMALL VIRTUAL WAREHOUSES"


PQ TEMOS O SISTEMA DE "AUTO-SUSPEND" 

HABILITADO... --> PQ GERALMENTE 


QUANDO TEMOS QUERIES MT LARGE, COMPLEXAS,




O FATO DE ESTARMOS USANDO UMA WAREHOUSE 
DE TAMANHO LARGE 

NAO VAI SER TAO RUIM, JUSTAMENTE 

PQ 

ESSA WAREHOUSE VAI SER CAPAZ DE PROCESSAR 
ESSAS QUERIES BEM MAIS RAPIDAMENTE, 

nao teremos custos tao grandes adicionais...














OK... ESSAS ERAM AS BEST PRACTICES 

ACERCA DOS VIRTUAL WAREHOUSES...







